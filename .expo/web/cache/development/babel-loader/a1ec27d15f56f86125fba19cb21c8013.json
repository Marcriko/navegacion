{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport React, { useEffect, useState } from \"react\";\nimport { Avatar } from \"react-native-elements\";\nimport * as firebase from \"firebase\";\nimport * as Permissions from \"expo-permissions\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport Toast from \"react-native-easy-toast\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function UserInfo(props) {\n  var _props$userInfo = props.userInfo,\n      uid = _props$userInfo.uid,\n      photoURL = _props$userInfo.photoURL,\n      displayName = _props$userInfo.displayName,\n      email = _props$userInfo.email,\n      toastRef = props.toastRef,\n      setLoading = props.setLoading,\n      setLoadingText = props.setLoadingText;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      name = _useState2[0],\n      setName = _useState2[1];\n\n  var changeAvatar = function changeAvatar() {\n    var resultPermission, resultPermissionCamera, result;\n    return _regeneratorRuntime.async(function changeAvatar$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n          case 2:\n            resultPermission = _context.sent;\n            console.log(resultPermission);\n            resultPermissionCamera = resultPermission.permissions.camera.status;\n\n            if (!(resultPermissionCamera == \"denied\")) {\n              _context.next = 9;\n              break;\n            }\n\n            toastRef.current.show(\"Es necesario otorgar permisos!!\");\n            _context.next = 14;\n            break;\n\n          case 9:\n            toastRef.current.show(\"OK\");\n            _context.next = 12;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              allowsEditing: true,\n              aspect: [4, 3]\n            }));\n\n          case 12:\n            result = _context.sent;\n\n            if (result.cancelled) {\n              toastRef.current.show(\"Has cancelado la operación!!\");\n            } else {\n              uploadImage(result.uri).then(function () {\n                updatePhotoURL();\n                toastRef.current.show(\"Imagen subida\");\n              }).catch(function () {\n                toastRef.current.show(\"Error al subir la imagen\");\n              });\n            }\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var uploadImage = function uploadImage(uri) {\n    var response, blob, ref;\n    return _regeneratorRuntime.async(function uploadImage$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setLoadingText(\"Cargando imagen\");\n            setLoading(true);\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(fetch(uri));\n\n          case 4:\n            response = _context2.sent;\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 7:\n            blob = _context2.sent;\n            ref = firebase.storage().ref().child(\"avatar/\" + uid);\n            return _context2.abrupt(\"return\", ref.put(blob));\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var updatePhotoURL = function updatePhotoURL() {\n    setLoadingText(\"Actualizando avatar\");\n    firebase.storage().ref(\"avatar/\" + uid).getDownloadURL().then(function _callee(response) {\n      var update;\n      return _regeneratorRuntime.async(function _callee$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              update = {\n                photoURL: response\n              };\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(firebase.auth().currentUser.updateProfile(update));\n\n            case 3:\n              setLoading(false);\n              console.log(\"imagen actualizada\");\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }).catch(function () {\n      setLoading(false);\n      toastRef.current.show(\"Error al actualizar la imagen !!\");\n    });\n  };\n\n  useEffect(function () {}, [name]);\n  return _jsxs(View, {\n    style: styles.viewUserInfo,\n    children: [_jsx(Avatar, {\n      onEditPress: function onEditPress() {\n        return changeAvatar();\n      },\n      rounded: true,\n      size: \"large\",\n      showEditButton: true,\n      containerStyle: styles.userAvatar,\n      source: photoURL ? {\n        uri: photoURL\n      } : require(\"../../../assets/avatar-default.jpg\")\n    }), _jsxs(View, {\n      children: [_jsx(Text, {\n        style: styles.userName,\n        children: name ? displayName : \"Anónimo\"\n      }), _jsx(Text, {\n        style: styles.userDates,\n        children: email ? email : \"Invitado\"\n      })]\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  viewUserInfo: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"row\",\n    backgroundColor: \"#fff\",\n    borderRadius: 10,\n    marginTop: 30,\n    padding: 15,\n    borderWidth: 2,\n    borderColor: \"#1b3258\"\n  },\n  userAvatar: {\n    marginRight: 20\n  },\n  userName: {\n    fontWeight: \"bold\",\n    paddingBottom: 5,\n    color: \"black\",\n    fontSize: 16\n  },\n  userDates: {\n    color: \"black\",\n    marginRight: 15,\n    fontSize: 16\n  }\n});","map":{"version":3,"sources":["C:/Users/Marco/Downloads/SIACI (1)/navegacion/src/components/account/UserInfo.js"],"names":["React","useEffect","useState","Avatar","firebase","Permissions","ImagePicker","Toast","UserInfo","props","userInfo","uid","photoURL","displayName","email","toastRef","setLoading","setLoadingText","name","setName","changeAvatar","askAsync","CAMERA","resultPermission","console","log","resultPermissionCamera","permissions","camera","status","current","show","launchImageLibraryAsync","allowsEditing","aspect","result","cancelled","uploadImage","uri","then","updatePhotoURL","catch","fetch","response","blob","ref","storage","child","put","getDownloadURL","update","auth","currentUser","updateProfile","styles","viewUserInfo","userAvatar","require","userName","userDates","StyleSheet","create","alignItems","justifyContent","flexDirection","backgroundColor","borderRadius","marginTop","padding","borderWidth","borderColor","marginRight","fontWeight","paddingBottom","color","fontSize"],"mappings":"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","sourcesContent":["import { StyleSheet, Text, View } from \"react-native\";\r\nimport React,{useEffect,useState} from \"react\";\r\nimport { Avatar } from \"react-native-elements\";\r\nimport * as firebase from \"firebase\";\r\nimport * as Permissions from \"expo-permissions\";\r\nimport * as ImagePicker from \"expo-image-picker\";\r\nimport Toast from \"react-native-easy-toast\";\r\n\r\nexport default function UserInfo(props) {\r\n  const {\r\n    userInfo: { uid, photoURL, displayName, email },\r\n    toastRef,\r\n    setLoading,\r\n    setLoadingText,\r\n  } = props;\r\n  const [name, setName] = useState(\"\")\r\n  const changeAvatar = async () => {\r\n    // console.log(\"ChangeAvatar\")\r\n    const resultPermission = await Permissions.askAsync(Permissions.CAMERA);\r\n    console.log(resultPermission);\r\n    const resultPermissionCamera = resultPermission.permissions.camera.status;\r\n    if (resultPermissionCamera == \"denied\") {\r\n      toastRef.current.show(\"Es necesario otorgar permisos!!\");\r\n    } else {\r\n      toastRef.current.show(\"OK\");\r\n      const result = await ImagePicker.launchImageLibraryAsync({\r\n        allowsEditing: true,\r\n        aspect: [4, 3],\r\n      });\r\n      // console.log(result);\r\n      if (result.cancelled) {\r\n        toastRef.current.show(\"Has cancelado la operación!!\");\r\n      } else {\r\n        uploadImage(result.uri)\r\n          .then(() => {\r\n            updatePhotoURL();\r\n            toastRef.current.show(\"Imagen subida\");\r\n          })\r\n          .catch(() => {\r\n            toastRef.current.show(\"Error al subir la imagen\");\r\n          });\r\n      }\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (uri) => {\r\n    setLoadingText(\"Cargando imagen\");\r\n    setLoading(true);\r\n    // console.log(uri);\r\n    const response = await fetch(uri);\r\n    // console.log(JSON.stringify(response));\r\n    const blob = await response.blob();\r\n    // console.log(JSON.stringify(blob));\r\n    const ref = firebase.storage().ref().child(`avatar/${uid}`);\r\n    return ref.put(blob);\r\n  };\r\n\r\n  const updatePhotoURL = () => {\r\n    setLoadingText(\"Actualizando avatar\");\r\n    firebase\r\n      .storage()\r\n      .ref(`avatar/${uid}`)\r\n      .getDownloadURL()\r\n      .then(async (response) => {\r\n        // console.log(response);\r\n        const update = {\r\n          photoURL: response,\r\n        };\r\n        await firebase.auth().currentUser.updateProfile(update);\r\n        setLoading(false);\r\n        console.log(\"imagen actualizada\");\r\n      })\r\n      .catch(() => {\r\n        setLoading(false);\r\n        toastRef.current.show(\"Error al actualizar la imagen !!\");\r\n      });\r\n  };\r\n  useEffect(()=> {\r\n  \r\n  },[name])\r\n  return (\r\n    <View style={styles.viewUserInfo}>\r\n      <Avatar\r\n        onEditPress={() => changeAvatar()}\r\n        rounded\r\n        size=\"large\"\r\n        showEditButton\r\n        containerStyle={styles.userAvatar}\r\n        source={\r\n          photoURL\r\n            ? { uri: photoURL }\r\n            : require(\"../../../assets/avatar-default.jpg\")\r\n        }\r\n      />\r\n      <View>\r\n        <Text style={styles.userName}>\r\n          {name ? displayName : \"Anónimo\"}\r\n        </Text>\r\n        <Text style={styles.userDates}>{email ? email : \"Invitado\"}</Text>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  viewUserInfo: {\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    flexDirection: \"row\",\r\n    backgroundColor: \"#fff\",\r\n    borderRadius: 10,\r\n    marginTop: 30,\r\n    padding: 15,\r\n    borderWidth: 2,\r\n    borderColor: \"#1b3258\",\r\n  },\r\n  userAvatar: {\r\n    marginRight: 20,\r\n  },\r\n  userName: {\r\n    fontWeight: \"bold\",\r\n    paddingBottom: 5,\r\n    color: \"black\",\r\n    fontSize: 16,\r\n  },\r\n  userDates: {\r\n    color: \"black\",\r\n    marginRight: 15,\r\n    fontSize: 16,\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}